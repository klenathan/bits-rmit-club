<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test site</title>

    <style>
        .avt{
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
        }
        .comment-wrapper{
            display: flex;
            flex-direction: row;
            background-color: aquamarine;
        }

    </style>
</head>

<body>
    <h1>Test Site</h1>
    <canvas></canvas>
    <h2 style="color: red">â™¥</h2>
    <div>

        <form id="login-form" action="">
            <input placeholder="Username" type="text" name="username" id="username">
            <input placeholder="Password" type="text" name="password" id="password">
            <input type="submit" value="Submit">
        </form>

        <button onclick="{console.log(Date.now())}">asd</button>

        <div id="post-wrapper">

        </div>
    </div>
    <script>
        const form = document.getElementById('login-form')

        const usernameInput = document.getElementById('username')
        const passwordInput = document.getElementById('password')

        fetch("/post")
            .then(response => {
                return response.json()
            })
            .then(result => {
                for (let post of result) {
                    let newPost = document.createElement('div')
                    newPost.style.background = "beige"

                    let author = document.createElement('h3')
                    author.innerText = post.postAuthor.name

                    let avt= document.createElement('img')
                    avt.className = 'avt'
                    avt.src = `image/${post.postAuthor.avatar}`

                    let status = document.createElement('p')
                    status.style.fontSize = "1.5rem"
                    status.innerText = post.content ?? "No content"

                    let updatedAt = document.createElement('p')
                    updatedAt.innerText = post.updatedAt
                    
                    let img;
                    

                    let likeCount = document.createElement('p')
                    likeCount.innerText = `${post.likes.length} Likes`

                    let commentsDiv = document.createElement('div')
                    commentsDiv.className = "comment-wrapper"
                    for (let commentContent of post.comments){
                        let comments = document.createElement('p')
                        comments.innerText = `${commentContent.username}: ${commentContent.comment}`
                        commentsDiv.appendChild(comments)
                    }

                    newPost.appendChild(author)
                    newPost.appendChild(avt)
                    newPost.appendChild(updatedAt)
                    // newPost.appendChild(name)
                    newPost.appendChild(status)
                    if (post.imgLink) {
                        img= document.createElement('img')
                        img.style.maxHeight = "400px"
                        img.src = `image/${post.imgLink}`
                        newPost.appendChild(img)
                    }
                    newPost.appendChild(likeCount)
                    newPost.appendChild(commentsDiv)

                    // newPost.innerText = JSON.stringify(result)
                    document.getElementById("post-wrapper").appendChild(newPost)
                }

            })

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            console.log(`${usernameInput.value} | ${passwordInput.value}`);
            let credential = {
                username: usernameInput.value,
                password: passwordInput.value
            }
            fetch("/auth/login", {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                method: "POST",
                body: JSON.stringify(credential)
            })
                .then(response => {
                    return response.json();
                })
                .then(result => {
                    if (result.name == "WRONG_CREDENTIAL") {
                        console.log(result.message);
                    } else if (result.status == 200) {
                        console.log("Login Success")
                        console.log(result)
                    } else {
                        console.log(result);
                    }
                })
        });
        
    </script>
</body>

</html>